{% extends 'base.html' %}

{% block content %}
    <h2>Manage Questions</h2>
    

    {% if request.user.role == 'teacher' or request.user.is_superuser %}
    <a href="{% url 'add_question' %}" class="btn btn-primary mb-3">Add New Question</a>
    <!-- <a href="{% url 'teacher_dashboard' %}" class="btn btn-secondary btn-sm ms-2 mb-3">Cancel</a> -->

    {% endif %}

    <div class="row">
        <!-- Left section: Questions List -->
        <div class="col-12 col-md-9 mb-3 mb-md-0">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Question</th>
                            <th scope="col">Options</th>
                            <th scope="col">Correct Answer</th>
                            <th scope="col">Category</th>
                            <th scope="col">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for mcq in mcqs %}
                            <tr>
                                <td>{{ mcq.question }}</td>
                                <td>
                                    A: {{ mcq.option_a }}<br>
                                    B: {{ mcq.option_b }}<br>
                                    C: {{ mcq.option_c }}<br>
                                    D: {{ mcq.option_d }}
                                </td>
                                <td>{{ mcq.correct_answer }}</td>
                                <td>
                                    <!-- Instead of dropdown, display the category name -->
                                    <span>{{ mcq.category }}</span>
                                </td>
                                <td>
                                    {% if request.user == mcq.teacher or request.user.is_superuser %}
                                        <a href="{% url 'edit_question' mcq.id %}" class="btn btn-info btn-sm">Edit</a>
                                        <!-- Delete link: when clicked, submit POST request to delete -->
                                        <form action="{% url 'delete_question' mcq.id %}" method="post" style="display: inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this question?')">Delete</button>
                                        </form>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Right section: Categorization Filter -->
        <div class="col-12 col-md-3">
            <h4>Filter by Category</h4>
            <form action="" method="get">
                <div class="form-group">
                    <select name="category" class="form-select" onchange="this.form.submit()">
                        <option value="">All Categories</option>
                        {% for category in categories %}
                            <option value="{{ category }}" {% if category == category_filter %} selected {% endif %}>{{ category }}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>
        </div>        
    </div>

{% endblock %}
